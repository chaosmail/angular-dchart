/** angular-dchart - v0.0.2 - Tue Jul 23 2013 23:11:39
 *  (c) 2013 Christoph KÃ¶rner, office@chaosmail.at, http://chaosmail.at
 *  License: MIT
 */
var __hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};void 0===Array.prototype.replace&&(Array.prototype.replace=function(a){this.splice(0,this.length);for(var b=0;b<a.length;b++)this.push(a[b])});var _dchart=function(){function a(){this.restrict="E",this.transclude=!0,this.scope={w:"=width",h:"=height"}}return a.prototype.getRandomColor=function(){return"hsl("+360*Math.random()+",100%,50%)"},a.prototype.getMinMaxValues=function(a){var b={x:0,y:0},c={x:0,y:0};return void 0===a||null===a?[b,c]:(angular.forEach(a,function(a){null!==a&&angular.forEach(a.data,function(a){a.x>c.x?c.x=a.x:a.x<b.x&&(b.x=a.x),a.y>c.y?c.y=a.y:a.y<b.y&&(b.y=a.y)})}),[b,c])},a.prototype.parseTransclude=function(a,b){var c=this,d=a(b);void 0!==d&&null!==d&&angular.forEach(d,function(a){a.nodeName.match(/^axis/i)?c.parseAxis(b.axis,a):a.nodeName.match(/^data-set/i)&&c.parseDataSet(b.data,a,b.axis)})},a.prototype.createSvg=function(a,b){if(void 0===a.svg||null===a.svg){var c=d3.select(b).append("svg").attr("width",a.w+a.margin.left+a.margin.right).attr("height",a.h+a.margin.top+a.margin.bottom).append("g").attr("class","dchart-container").attr("transform","translate("+a.margin.left+", "+a.margin.top+")");a.svg=c}},a.prototype.ngCompile=function(){},a.prototype.ngLink=function(){},a.prototype.ngWatch=function(){},a.prototype.compile=function(a,b,c){var d=this,e=c;return d.ngCompile(a,b,c),function(a,b,c){a.margin={top:0,right:0,bottom:0,left:0},d.ngLink(a,b,c),d.initializeAxis(a),d.initializeData(a),d.parseTransclude(e,a),d.calculateFnData(a),d.createSvg(a,b[0]),a.$watch("[data]",function(a,b,c){d.prepareChart(c),d.drawAxis(c),d.drawData(c),d.ngWatch(a,b,c)},!0)}},a}(),_dchart2D=function(a){function b(){var a=b.__super__.constructor.apply(this,arguments);return a}return __extends(b,a),b.prototype.prepareChart=function(a){if(void 0!==a.data&&null!==a.data){var b=this,c=[],d=0;angular.forEach(a.data,function(e){var f=JSON.parse(JSON.stringify(e));b.prepareDataSet(f,d),c.push(f),b.prepareAxis(a.axis,f,d),d++}),a.drawDataSets=c}},b.prototype.prepareAxis=function(a,b){void 0===b||null===b},b.prototype.prepareDataSet=function(a){if(void 0!==a&&null!==a){var b=this,c=0;angular.forEach(a.data,function(a){b.prepareData(a,c),c++})}},b.prototype.prepareData=function(a){void 0===a||null===a},b.prototype.parseDataSet=function(a,b,c){if(null!==b){var d={label:"",stroke:this.getRandomColor(),fill:"#000",opacity:1,fillOpacity:1,strokeWidth:1,fn:void 0,min:0,max:0,interpolate:"linear",data:[],dataFn:void 0},e=this;xAxis=c.x,angular.forEach(b.attributes,function(a){if(a.nodeName.match(/^label$/i))d.label=a.nodeValue;else if(a.nodeName.match(/^stroke$/i))d.stroke=a.nodeValue;else if(a.nodeName.match(/^interpolate$/i))d.interpolate=a.nodeValue;else if(a.nodeName.match(/^fill$/i))d.fill=a.nodeValue;else if(a.nodeName.match(/^min$/i))d.min=parseFloat(a.nodeValue);else if(a.nodeName.match(/^max$/i))d.max=parseFloat(a.nodeValue);else if(a.nodeName.match(/^stroke-width$/i))d.strokeWidth=parseFloat(a.nodeValue);else if(a.nodeName.match(/^fill-opacity$/i))d.fillOpacity=parseFloat(a.nodeValue);else if(a.nodeName.match(/^opacity$/i))d.opacity=parseFloat(a.nodeValue);else if(a.nodeName.match(/^data$/i)){if(void 0===a.nodeValue||null===a.nodeValue)return;var c=angular.element(b).scope(),e=a.nodeValue.split("."),f=c.$parent,g=0;if(angular.forEach(e,function(a){f.hasOwnProperty(a)&&(f=f[a],g++)}),!g)return;"function"==typeof f?d.fn=f:d.data=f}}),angular.forEach(b.children,function(a){if(a.nodeName.match(/^data/i)){var b=e.parseData(a);null!==b&&d.data.push(b)}}),a.push(d)}},b.prototype.solveFn=function(a,b){if(void 0!==a.fn&&null!==a.fn){var c=b.x,d=a.min?a.min:c.range[0]?parseFloat(c.range[0]):0,e=a.max?a.max:c.range[1]?parseFloat(c.range[1]):180,f=c.ticks?parseFloat(c.ticks):10,g=(e-d)/f;a.data.replace((new _solver).solve(a.fn,d,e,g))}},b.prototype.calculateFnData=function(a){if(void 0!==a.data&&0!==a.data.length){var b=this;angular.forEach(a.data,function(c){void 0!==c.fn&&b.solveFn(c,a.axis)}),a.drawDataSets=a.data}},b.prototype.parseData=function(a){if(null===a)return null;var b={x:0,y:0,t:0,w:1,label:a.innerText};return angular.forEach(a.attributes,function(a){a.nodeName.match(/^x$/i)?b.x=parseFloat(a.nodeValue):a.nodeName.match(/^(y|val|value)$/i)?b.y=parseFloat(a.nodeValue):a.nodeName.match(/^(t|time)$/i)?b.t=parseFloat(a.nodeValue):a.nodeName.match(/^(w|weight)$/i)&&(b.w=parseFloat(a.nodeValue))}),b},b.prototype.parseAxis=function(a,b){if(null!==b){var c=this;angular.forEach(b.children,function(b){b.nodeName.match(/^x/i)?c.parseAxisAttributes(a.x,b):b.nodeName.match(/^y/i)&&c.parseAxisAttributes(a.y,b)})}},b.prototype.parseAxisAttributes=function(a,b){null!==b&&(a.label=b.innerText,angular.forEach(b.attributes,function(b){if(b.nodeName.match(/^ticks$/i))a.ticks=parseInt(b.nodeValue,10);else if(b.nodeName.match(/^range$/i))a.rangeOpt=b.nodeValue.replace(/[\[\]]/g,"").split(",");else if(b.nodeName.match(/^align$/i)){var c=b.nodeValue;"x"===a.type&&["top","center","bottom"].indexOf(c)>=0?a.align=c:"y"===a.type&&["left","center","right"].indexOf(c)>=0&&(a.align=c)}else if(b.nodeName.match(/^label-pos$/i)){var d=b.nodeValue;["start","middle","end"].indexOf(d)>=0&&(a.labelPos=d)}}))},b.prototype.initializeAxis=function(a){return void 0!==a.axis&&null!==a.axis?this:(a.axis={x:{type:"x",range:[0,1],rangeOpt:"auto",label:"",align:"bottom",ticks:10,ticksFormat:[],labelPos:"middle"},y:{type:"y",range:[0,1],rangeOpt:"auto",label:"",align:"left",ticks:10,ticksFormat:[],labelPos:"middle"}},this)},b.prototype.initializeData=function(a){return void 0!==a.data&&null!==a.data?this:(a.data=[],this)},b.prototype.drawAxis=function(a){var b=_dchart.prototype.getMinMaxValues(a.drawDataSets);a.axis.x.range="auto"===a.axis.x.rangeOpt?[b[0].x,b[1].x]:a.axis.x.rangeOpt,a.axis.y.range="auto"===a.axis.y.rangeOpt?[b[0].y,b[1].y]:a.axis.y.rangeOpt;var c="center"===a.axis.x.align?.5*a.h:"top"===a.axis.x.align?0:a.h,d="top"===a.axis.x.align?"top":"bottom",e="start"===a.axis.x.labelPos?0:"middle"===a.axis.x.labelPos?.5*a.w:a.w,f="center"===a.axis.y.align?.5*a.w:"right"===a.axis.y.align?a.w:0,g="right"===a.axis.y.align?"right":"left",h="start"===a.axis.y.labelPos?a.h:"middle"===a.axis.y.labelPos?.5*a.h:0;a.xScale=d3.scale.linear().domain(a.axis.x.range).range([0,a.w]),a.yScale=d3.scale.linear().domain(a.axis.y.range).range([a.h,0]);var i=d3.svg.axis().scale(a.xScale).orient(d).ticks(a.axis.x.ticks),j=d3.svg.axis().scale(a.yScale).orient(g).ticks(a.axis.y.ticks);a.axis.x.ticksFormat.length>0&&i.tickFormat(function(b){return a.axis.x.ticksFormat[b]}),a.axis.y.ticksFormat.length>0&&i.tickFormat(function(b){return a.axis.y.ticksFormat[b]}),(void 0===a.svgXAxis||null===a.svgXAxis)&&(a.svgXAxis=a.svg.append("g").attr("class","axis").call(i),a.svgXAxisLabel=a.svg.append("g").attr("class","axis-label").append("text").attr("text-anchor",a.axis.x.labelPos).attr("x",e).attr("y",a.h+34)),(void 0===a.svgYAxis||null===a.svgYAxis)&&(a.svgYAxis=a.svg.append("g").attr("class","axis").call(j),a.svgYAxisLabel=a.svg.append("g").attr("class","axis-label").append("text").attr("text-anchor",a.axis.y.labelPos).attr("x",-h).attr("y",-34).attr("transform","rotate(-90)")),a.svgXAxis.transition().duration(150).ease("cubicin").attr("transform","translate(0,"+c+")").call(i),a.svgYAxis.transition().duration(150).ease("cubicin").attr("transform","translate("+f+",0)").call(j),a.svgXAxisLabel.text(a.axis.x.label),a.svgYAxisLabel.text(a.axis.y.label)},b}(_dchart),_solver=function(){function a(){}return a.prototype.solve=function(a,b,c,d){for(var e=[],f=b;c>=f;f+=d)e.push({x:f,y:a(f)});return e},a}();angular.module("dchart.solver",[]).service("dchartSolver",function(){return new _solver});var _dchartHisto=function(a){function b(){var a=b.__super__.constructor.apply(this,arguments);return a}return __extends(b,a),b.prototype.prepareAxis=function(a,b){void 0!==b&&null!==b&&(a.x.ticks=b.data.length,a.x.ticksFormat=[""],angular.forEach(b.data,function(b){a.x.ticksFormat.push(b.label)}),"left"===a.y.align,"right"===a.y.align)},b.prototype.prepareData=function(a,b){void 0!==a&&null!==a&&(a.hasOwnProperty("x")||(a.x=b+1))},b.prototype.ngLink=function(a){a.margin={top:50,right:50,bottom:50,left:50}},b.prototype.ngWatch=function(){},b.prototype.drawData=function(a){var b=a.drawDataSets.length,c=.8*(1*(a.w/a.axis.x.ticks)/b),d=0;(void 0===a.svgData||null===a.svgData)&&(a.svgData=[]),angular.forEach(a.drawDataSets,function(e,f){(void 0===a.svgData[f]||null===a.svgData[f])&&(a.svgData[f]=a.svg.append("g").attr("class","data"));var g=a.svgData[f].selectAll("rect").data(e.data,function(a){return a.x+" - "+a.y});g.attr("x",function(e){return a.xScale(e.x)-.5*c*b+d*c}).attr("width",function(){return c}),g.enter().append("rect").style("stroke",e.stroke).style("fill",function(a){return a.hasOwnProperty("color")?a.color:e.fill}).style("opacity",e.opacity).style("fill-opacity",e.fillOpacity).style("stroke-width",e.strokeWidth).attr("x",function(e){return a.xScale(e.x)-.5*c*b+d*c}).attr("y",a.h).attr("width",function(){return c}).attr("height",0).transition().duration(150).ease("cubicin").attr("y",function(b){return a.yScale(b.y)}).attr("height",function(b){return a.h-a.yScale(b.y)}),g.exit().transition().duration(150).ease("cubicout").attr("y",a.h).attr("height",0).each("end",function(){d3.select(this).remove()}),d++})},b}(_dchart2D);angular.module("dchart.histo",[]).directive("dchartHisto",function(){return new _dchartHisto});var _dchartLine=function(a){function b(){var a=b.__super__.constructor.apply(this,arguments);return a}return __extends(b,a),b.prototype.ngLink=function(a){a.margin={top:50,right:50,bottom:50,left:50}},b.prototype.ngWatch=function(){},b.prototype.drawData=function(a){(void 0===a.svgData||null===a.svgData)&&(a.svgData=[],a.lineFn=[]),angular.forEach(a.drawDataSets,function(b,c){(void 0===a.svgData[c]||null===a.svgData[c])&&(a.svgData[c]=a.svg.append("g").attr("class","data").append("svg:path"),a.lineFn[c]=d3.svg.line().interpolate(b.interpolate).x(function(b){return a.xScale(b.x)}).y(function(b){return a.yScale(b.y)})),a.svgData[c].transition().duration(150).ease("cubicin").attr("d",a.lineFn[c](b.data)).style("stroke",b.stroke).style("fill","none").style("stroke-width",b.strokeWidth)})},b}(_dchart2D);angular.module("dchart.line",[]).directive("dchartLine",function(){return new _dchartLine});var _dchartScatter=function(a){function b(){var a=b.__super__.constructor.apply(this,arguments);return a}return __extends(b,a),b.prototype.ngLink=function(a){a.margin={top:50,right:50,bottom:50,left:50}},b.prototype.ngWatch=function(){},b.prototype.drawData=function(a){var b=10;(void 0===a.svgData||null===a.svgData)&&(a.svgData=[],a.symbolFn=[]),angular.forEach(a.drawDataSets,function(c,d){(void 0===a.svgData[d]||null===a.svgData[d])&&(a.svgData[d]=a.svg.append("g").attr("class","data"));var e=a.svgData[d].selectAll("circle").data(c.data,function(a){return a.y});e.exit().transition().duration(150).ease("cubicout").attr("r",0).each("end",function(){d3.select(this).remove()}),e.attr("cx",function(b){return a.xScale(b.x)}).attr("cy",function(b){return a.yScale(b.y)}),e.enter().append("circle").style("stroke",c.stroke).style("fill",c.fill).style("opacity",c.opacity).style("fill-opacity",c.fillOpacity).style("stroke-width",c.strokeWidth).attr("cx",function(b){return a.xScale(b.x)}).attr("cy",function(b){return a.yScale(b.y)}).attr("r",0).transition().duration(150).ease("cubicin").attr("r",function(a){return a.w*b})})},b}(_dchart2D);angular.module("dchart.scatter",[]).directive("dchartScatter",function(){return new _dchartScatter});